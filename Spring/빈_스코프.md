# 빈 스코프(bean scope)

## 스코프의 종류

1. 싱글톤
   - 스프링 컨테이너의 시작과 종료까지 유지 , 기본 스코프
3. 프로토타입
   - 빈의 생성과 DI 까지만 관여
5. 웹 스코프 (리퀘스트,세션 etc...)
   - 웹 환경에서 동작하는 스코프

## 등록 방법

#### @Scope("prototype")

#### 자동 등록 , 수동 등록 모두 가능

## 프로토타입 빈 VS 싱글톤 빈

#### 싱글톤빈
#### - 스프링 컨테이너에서 빈을 생성 후 같은 요청이 올 때마다 같은 빈을 반환 

#### 프로토타입빈
#### - 같은 요청이 올때마다 빈을 생성하고 DI를 주입한

#### 싱글톤 스코프와는 다르게 조회할 때마다 새로운 인스턴스를 생성한다.
#### 빈을 생성하고 DI , 초기화까지만 관여

## 프로토타입 스코프의 작동 방식
![image](https://github.com/2jie0516/TIL/assets/102570281/c1458ceb-e1df-4b55-9c5f-69d4241a8a8c)

#### 프로토타입 스코프의 특징  
1. 요청이 올때마다 빈을 생성
2. 생성,DI,초기화까지만 관여
3. preDestroy같은 종료 메소드 호출 x
4. 클라이언트가 빈을 관리한다.


## 싱글톤과 사용 시 주의사항

#### 싱글톤 스프링 컨테이너에 프로토타입 빈이 보관되면 싱글톤처럼 사용된다 !
#### 프로토타입 빈은 요청이 올때마다 생성되는 것이지 , 사용할때마다 생성되는 것이 아니기 때문

#### 이 문제를 프로바이더로 해결할 수 있다.  

프로바이더는 필요한 의존관계를 찾아주는 DL(Dependency Lookup)을 사용한다.

#### 프로바이더의 종료

1. ObjectFactory, ObjectProvider
2. JSR-330 Provider 


## 웹 스코프

웹 환경에서만 동작한다.
스프링이 종료시점까지 관리해준다.

#### 윕 스코프의 종류
1. request : HTTP 요청 하나가 들어오고 나갈때까지 유지 , 요청마다 별도의 인스턴스 생성
2. session : HTTP 세션과 동일한 생명주기
3. application : 서블릿 컨텍스트와 동일한 생명주기
4. websocket : 웹 소켓과 동일한 생명주기

#### 웹 스코프 프로바이더

실제 고객 요청이 와야 생성 가능한 빈을 다른 방법으로 어떻게 생성할까?

1. 프로바이더
  - ObjectProvider를 이용하여 request 빈의 생성을 지연할 수 있다.
2. 프록시
   - 가짜 프록시 객체를 만들어서 주입한다.

## 프로바이더 , 프록시를 통해서 진짜 객체 조회를 꼭 필요한 시점까지 지연시킬 수 있다.
